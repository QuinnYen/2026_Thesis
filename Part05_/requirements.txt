# æ¨¡çµ„åŒ–æƒ…æ„Ÿåˆ†æç³»çµ± - ä¾è³´å¥—ä»¶æ¸…å–®
# =========================================
# æ›´æ–°æ—¥æœŸ: 2025-06-12
# ç³»çµ±ï¼šè·¨é ˜åŸŸæƒ…æ„Ÿåˆ†æèˆ‡å¤šé‡ç·¨ç¢¼å™¨/åˆ†é¡å™¨æ¶æ§‹å¹³å°
# åŠŸèƒ½ï¼šBERT/GPT/T5ç·¨ç¢¼å™¨ + XGBoost/é‚è¼¯è¿´æ­¸/éš¨æ©Ÿæ£®æ—/SVMåˆ†é¡å™¨ + æ³¨æ„åŠ›æ©Ÿåˆ¶åˆ†æ

# ============================
# æ ¸å¿ƒä¾è³´å¥—ä»¶ (å¿…éœ€å®‰è£)
# ============================

# æ·±åº¦å­¸ç¿’æ¡†æ¶
# ============
torch>=1.9.0,<2.1.0          # PyTorchæ·±åº¦å­¸ç¿’æ¡†æ¶ï¼Œæ”¯æ´CUDAåŠ é€Ÿï¼Œç”¨æ–¼BERTç·¨ç¢¼å’Œæ³¨æ„åŠ›æ©Ÿåˆ¶
transformers>=4.0.0,<5.0.0   # Hugging Face Transformersï¼šBERT/GPT/T5ç­‰é è¨“ç·´æ¨¡å‹
tokenizers>=0.13.0,<1.0.0    # é«˜é€Ÿåˆ†è©å™¨ï¼ˆTransformersä¾è³´ï¼Œè‡ªå‹•å®‰è£ï¼‰

# æ©Ÿå™¨å­¸ç¿’æ ¸å¿ƒå¥—ä»¶
# ================
scikit-learn>=1.0.0,<1.4.0   # æ©Ÿå™¨å­¸ç¿’å·¥å…·åŒ…ï¼šé‚è¼¯è¿´æ­¸ã€éš¨æ©Ÿæ£®æ—ã€SVMã€è©•ä¼°æŒ‡æ¨™ã€æ•¸æ“šé è™•ç†
xgboost>=1.6.0,<2.1.0        # é«˜æ€§èƒ½æ¢¯åº¦æå‡æ¨¹åˆ†é¡å™¨ï¼ˆé è¨­åˆ†é¡å™¨ï¼‰ï¼Œæ”¯æ´GPUåŠ é€Ÿ
numpy>=1.21.0,<1.26.0        # æ•¸å€¼è¨ˆç®—åŸºç¤åº«ï¼Œç”¨æ–¼ç‰¹å¾µå‘é‡è™•ç†
pandas>=1.3.0,<2.1.0         # æ•¸æ“šåˆ†æèˆ‡æ“ä½œåº«ï¼Œç”¨æ–¼CSVè®€å¯«å’Œæ•¸æ“šæ¡†æ“ä½œ

# è‡ªç„¶èªè¨€è™•ç†
# ============
nltk>=3.6,<4.0               # è‡ªç„¶èªè¨€è™•ç†å·¥å…·åŒ…ï¼šåˆ†è©ã€åœç”¨è©ç§»é™¤ã€èªè¨€è³‡æº
beautifulsoup4>=4.9.0,<5.0.0 # HTMLè§£æå™¨ï¼Œç”¨æ–¼æ–‡æœ¬æ¸…ç†å’Œé è™•ç†

# å·¥å…·å¥—ä»¶
# ========
tqdm>=4.60.0,<5.0.0          # é€²åº¦æ¢é¡¯ç¤ºï¼Œç”¨æ–¼GUIé€²åº¦è¿½è¹¤
joblib>=1.0.0,<2.0.0         # é«˜æ•ˆåºåˆ—åŒ–åº«ï¼Œç”¨æ–¼æ¨¡å‹æŒä¹…åŒ–å’Œå‘é‡ä¿å­˜

# ============================
# é€²éšåŠŸèƒ½å¥—ä»¶ (å¯é¸å®‰è£)
# ============================

# ä¸»é¡Œå»ºæ¨¡èˆ‡åˆ†ç¾¤åˆ†æ
# ==================
gensim>=4.0.0,<5.0.0         # ä¸»é¡Œå»ºæ¨¡åº«ï¼šLDAä¸»é¡Œåˆ†æï¼ˆå¯¦éš›ä½¿ç”¨ï¼‰
bertopic>=0.9.0,<1.0.0       # åŸºæ–¼BERTçš„é€²éšä¸»é¡Œå»ºæ¨¡ï¼ˆå¯¦éš›ä½¿ç”¨ï¼‰
umap-learn>=0.5.0,<1.0.0     # éç·šæ€§é™ç¶­ç®—æ³•ï¼ˆBERTopicä¾è³´ï¼Œå¯¦éš›ä½¿ç”¨ï¼‰
hdbscan>=0.8.0,<1.0.0        # å¯†åº¦èšé¡ç®—æ³•ï¼ˆBERTopicä¾è³´ï¼Œå¯¦éš›ä½¿ç”¨ï¼‰

# ç§‘å­¸è¨ˆç®—æ“´å±•
# ============
scipy>=1.7.0,<1.12.0         # ç§‘å­¸è¨ˆç®—åº«ï¼Œç”¨æ–¼æ•¸å€¼å„ªåŒ–å’Œçµ±è¨ˆåˆ†æ

# ============================
# ç‰¹æ®Šç·¨ç¢¼å™¨å¥—ä»¶ (é«˜ç´šåŠŸèƒ½)
# ============================
# æ³¨æ„ï¼šä»¥ä¸‹å¥—ä»¶ç‚ºé€²éšåŠŸèƒ½ï¼Œéœ€è¦é¡å¤–é…ç½®å’Œå¤§é‡è¨˜æ†¶é«”
# allennlp>=2.0.0,<3.0.0       # ELMoæ–‡æœ¬ç·¨ç¢¼å™¨æ”¯æ´ï¼ˆå¯é¸ï¼Œéœ€8GB+ RAMï¼‰
# allennlp-models>=2.0.0,<3.0.0 # ELMoé è¨“ç·´æ¨¡å‹ï¼ˆå¯é¸ï¼Œéœ€å¤§é‡ç£ç¢Ÿç©ºé–“ï¼‰

# =====================================
# å®‰è£æŒ‡å—ï¼š
# =====================================

# ğŸš€ æ–¹æ¡ˆä¸€ï¼šæœ€å°å®‰è£ï¼ˆåƒ…æ ¸å¿ƒåŠŸèƒ½ï¼Œç´„1.5GBï¼‰
# æ¨è–¦åˆæ¬¡å®‰è£æˆ–è¨˜æ†¶é«”æœ‰é™ç’°å¢ƒ
pip install torch>=1.9.0 transformers>=4.0.0 scikit-learn>=1.0.0 xgboost>=1.6.0 numpy>=1.21.0 pandas>=1.3.0 nltk>=3.6 beautifulsoup4>=4.9.0 tqdm>=4.60.0 joblib>=1.0.0

# ğŸŒŸ æ–¹æ¡ˆäºŒï¼šé€²éšå®‰è£ï¼ˆåŒ…å«ä¸»é¡Œå»ºæ¨¡ï¼Œç´„2.5GBï¼‰
# æ¨è–¦å¤§éƒ¨åˆ†ä½¿ç”¨æƒ…å¢ƒ
pip install torch>=1.9.0 transformers>=4.0.0 scikit-learn>=1.0.0 xgboost>=1.6.0 numpy>=1.21.0 pandas>=1.3.0 nltk>=3.6 beautifulsoup4>=4.9.0 tqdm>=4.60.0 joblib>=1.0.0 gensim>=4.0.0 bertopic>=0.9.0 umap-learn>=0.5.0 hdbscan>=0.8.0 scipy>=1.7.0

# ğŸ’ª æ–¹æ¡ˆä¸‰ï¼šå®Œæ•´å®‰è£ï¼ˆæ‰€æœ‰åŠŸèƒ½ï¼‰
pip install -r requirements.txt

# ğŸ® GPUåŠ é€Ÿå®‰è£ï¼ˆå¼·çƒˆæ¨è–¦ï¼Œæå‡10-50å€é€Ÿåº¦ï¼‰
# æ­¥é©Ÿ1ï¼šå®‰è£CUDAç‰ˆæœ¬çš„PyTorch
pip install torch torchvision --index-url https://download.pytorch.org/whl/cu118
# æ­¥é©Ÿ2ï¼šå®‰è£å…¶é¤˜å¥—ä»¶
pip install -r requirements.txt

# =====================================
# é©—è­‰å®‰è£ï¼š
# =====================================

# âœ… é©—è­‰æ ¸å¿ƒåŠŸèƒ½
python -c "import torch, transformers, sklearn, xgboost, pandas, numpy; print('âœ… æ ¸å¿ƒå¥—ä»¶å®‰è£æˆåŠŸ')"

# âœ… é©—è­‰æ¨¡çµ„åŒ–æ¶æ§‹
python -c "from modules.encoder_factory import EncoderFactory; from modules.aspect_factory import AspectFactory; print('âœ… æ¨¡çµ„åŒ–æ¶æ§‹å¯ç”¨')"

# âœ… é©—è­‰GPUæ”¯æ´ï¼ˆå¯é¸ï¼‰
python -c "import torch; print(f'âœ… GPUå¯ç”¨: {torch.cuda.is_available()}, è¨­å‚™æ•¸é‡: {torch.cuda.device_count()}')"

# âœ… é©—è­‰é€²éšåŠŸèƒ½ï¼ˆå¯é¸ï¼‰
python -c "import bertopic, umap, hdbscan; print('âœ… é€²éšä¸»é¡Œå»ºæ¨¡å¥—ä»¶å¯ç”¨')"

# =====================================
# ç³»çµ±éœ€æ±‚ï¼š
# =====================================
# ğŸ–¥ï¸  Python: 3.8+ (å»ºè­°3.9+)
# ğŸ’¾ è¨˜æ†¶é«”: 8GB æœ€ä½ / 16GB æ¨è–¦ / 32GB å¤§è¦æ¨¡å¯¦é©—
# ğŸ® GPU: 4GB+ VRAM (å¯é¸ï¼Œç”¨æ–¼åŠ é€Ÿ) / 8GB+ å¤§æ¨¡å‹
# ğŸ’¿ ç£ç¢Ÿ: 10GB+ (åŒ…å«æ¨¡å‹ä¸‹è¼‰)
# ğŸŒ ç¶²è·¯: é¦–æ¬¡ä½¿ç”¨éœ€ä¸‹è¼‰BERTæ¨¡å‹ï¼ˆç´„2-5GBï¼‰

# =====================================
# é¦–æ¬¡é‹è¡Œè¨­å®šï¼š
# =====================================

# ğŸ“¥ ä¸‹è¼‰NLTKèªè¨€è³‡æº
python -c "import nltk; nltk.download(['punkt', 'stopwords', 'wordnet', 'omw-1.4'])"

# ğŸ¤– BERTæ¨¡å‹æœƒåœ¨é¦–æ¬¡ä½¿ç”¨æ™‚è‡ªå‹•ä¸‹è¼‰
# ä½ç½®ï¼š~/.cache/huggingface/transformers/

# =====================================
# å¸¸è¦‹å•é¡Œè§£æ±ºï¼š
# =====================================

# ğŸ”§ å‡ç´špipï¼ˆå®‰è£å¤±æ•—æ™‚ï¼‰
python -m pip install --upgrade pip

# ğŸš€ ä½¿ç”¨åœ‹å…§é¡åƒï¼ˆç¶²è·¯å•é¡Œï¼‰
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/

# ğŸ’» å¼·åˆ¶ä½¿ç”¨CPUï¼ˆCUDAéŒ¯èª¤ï¼‰
export CUDA_VISIBLE_DEVICES=""

# ğŸ§¹ æ¸…ç†å¿«å–ï¼ˆç£ç¢Ÿç©ºé–“ä¸è¶³ï¼‰
pip cache purge

# =====================================